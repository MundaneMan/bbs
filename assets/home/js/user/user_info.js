var datalist=data;$(function(){xmbbs={notieFun:function(msg){var s1="<div class='modal_full in'><div class='modal-backdrop'></div><div class='modal'><span class='close'></span><h3>"+langgobale[150].string+"</h3><div>",s2="</div></div></div>";$("body").append(s1+msg+s2);$(".modal_full").fadeIn("normal",function(){setTimeout(function(){$(".modal_full").fadeOut("fast",function(){$(this).remove()})},1e3)})},birthdaySet:function(){var $YearSelector=$("#sel_year"),$MonthSelector=$("#sel_month"),$DaySelector=$("#sel_day"),str="<li>--</li>",yearNow=(new Date).getFullYear();for(var i=yearNow;i>=1900;i--){var yearStr="<li>"+i+"</li>";$YearSelector.append(yearStr)}for(var i=1;i<=12;i++){var monthStr="<li>"+i+"</li>";$MonthSelector.append(monthStr)}function day(){var year=parseInt($("#year").html());var month=parseInt($("#month").html());var dayCount=0;$DaySelector.html("");if(month==2){dayCount=28;if(year%4==0&&year%100!=0||year%400==0){dayCount=29}}else if(month==4||month==6||month==9||month==11){dayCount=30}else{dayCount=31}for(var i=1;i<=dayCount;i++){var dayStr="<li>"+i+"</li>";$DaySelector.append(dayStr)}}$MonthSelector.find("li").click(function(){$("#month").html($(this).html());day()});$YearSelector.find("li").click(function(){$("#year").html($(this).html());day()});day()},zipcodeGet:function(province,city,stress){for(var i=0,l=datalist.length;i<l;i++){if(datalist[i].id==province){var oCity=datalist[i].child;for(var j in oCity){if(oCity[j].id==city){var oStress=oCity[j].child;for(var k in oStress){if(oStress[k].id==stress){return oStress[k].zipcode}}}}}}},addressSet:function(){var data=datalist,provice=$(".J_province"),city=$(".J_city"),district=$(".J_district"),defaultprovice=provice.attr("value"),defaultcity=city.attr("value"),defaultdistrict=district.attr("value"),province_obj=city_obj=district_obj="";provice.append('<option value="bl">'+langgobale[23].string+"</option>");city.append('<option value="bl">'+langgobale[21].string+"</option>");district.append('<option value="bl">'+langgobale[22].string+"</option>");for(var i=0,l=data.length;i<l;i++){var dataId=data[i].id,dataName=data[i].name;if(dataId!=defaultprovice){if(dataId==0){provice.html("").append("<option value='"+dataId+"' selected='selected'>"+dataName+"</option>")}else{provice.append("<option value='"+dataId+"'>"+dataName+"</option>")}}else{provice.append("<option value='"+dataId+"' selected='selected'>"+dataName+"</option>");province_obj=data[i].child;for(var j in province_obj){var proviceId=province_obj[j].id,proviceName=province_obj[j].name;if(province_obj[j].id!=defaultcity){city.append("<option value='"+proviceId+"'>"+proviceName+"</option>")}else{city.append("<option value='"+proviceId+"'selected='selected'>"+proviceName+"</option>");city_obj=province_obj[j].child;for(var k in city_obj){var cityId=city_obj[k].id,cityName=city_obj[k].name;if(city_obj[k].id!=defaultdistrict){district.append("<option value='"+cityId+"'>"+cityName+"</option>")}else{district.append("<option value='"+cityId+" 'selected='selected'>"+cityName+"</option>")}}}}}}provice.on("change",function(){var val=provice.find("option:selected").attr("value");city.html('<option value="bl">'+langgobale[21].string+"</option>").attr("value",0);district.html('<option value="bl">'+langgobale[22].string+"</option>").attr("value",0);if(val!="bl"){for(var i=0,l=data.length;i<l;i++){if(data[i].id==val){province_obj=data[i].child;for(var j in province_obj){city.append("<option value='"+province_obj[j].id+"''>"+province_obj[j].name+"</option>")}}}provice.attr("value",val)}});city.on("change",function(){var val=city.find("option:selected").attr("value");district.html('<option value="bl">'+langgobale[21].string+"</option>").attr("value",0);if(val!="bl"){for(var i=0,l=province_obj.length;i<l;i++){if(province_obj[i].id==val){city_obj=province_obj[i].child;for(var j in city_obj){district.append("<option value='"+city_obj[j].id+"''>"+city_obj[j].name+"</option>")}}}city.attr("value",val)}});district.on("change",function(){var val=district.find("option:selected").attr("value");district.attr("value",val);for(var i=0,len=city_obj.length;i<len;i++){if(city_obj[i].id==val){$(".zipcode").val(city_obj[i].zipcode)}}})},submitClick:function(){var _t=this;$(".errormsg").remove();var qq=$(".qq"),year=$("#year").html(),month=$("#month").html(),day=$("#day").html(),identitycard=$(".identitycard"),personhomepage=$(".personhomepage"),province=$(".J_province").attr("value"),city=$(".J_city").attr("value"),stress=$(".J_district").attr("value"),telphone=$(".telphone"),email=$(".email"),address=$(".postaddress"),username=$(".name"),zipcode=$(".zipcode"),messageflag=true,str="<span class='errormsg'>"+langgobale[13].string+"</span>";var usernameval=username.val();if(usernameval==""){username.after(str);messageflag=false}var emailval=email.val();if(emailval==""||!emailval.match(/^([.a-zA-Z0-9_-])+@([a-zA-Z0-9_-])+((.[a-zA-Z0-9_-]{2,3}){1,2})$/)){email.after(str);messageflag=false}var telphoneval=telphone.val();if(telphoneval==""||telphoneval.length<8||telphoneval.match(/[^0-9+]/g)){telphone.after(str);messageflag=false}var qqval=qq.val();if(qqval==""||qqval.match(/[^0-9]/g)||qqval.length>15||qqval.length<2){qq.after(str);messageflag=false}var identitycardval=identitycard.val();if(identitycardval){var num=identitycardval.toUpperCase();if(!/(^\d{15}$)|(^\d{17}([0-9]|X)$)/.test(num)){identitycard.after(str);messageflag=false}}if(province==0||city==0||stress==0){$(".residence").append(str);messageflag=false}var addressval=address.val();if(addressval==""||addressval.length<5||addressval.length>32||addressval.match(/^\d+$/g)||addressval.match(/^[0-9a-zA-Z]+$/g)){address.after("<span class='errormsg'>地址不正确</span>");messageflag=false}var zipcodeval=zipcode.val();if(zipcodeval!=""&&(zipcodeval.length!=6||zipcodeval.match(/[^0-9]/g))){zipcode.after(str);messageflag=false}if(messageflag){if(zipcodeval==""){zipcodeval=_t.zipcodeGet(province,city,stress);zipcode.val(zipcodeval)}$.ajax({url:"/user/doedit",data:{qq:qqval,userrealy:usernameval,telphone:telphoneval,mailaddress:addressval,email:emailval,sex:$("#sex").attr("date-val"),identitycard:identitycardval,zipcode:zipcodeval,address:{province:province,city:city,stress:stress},birthday:{year:year,month:month,day:day},personhomepage:$(".personhomepage").val(),personsignature:$(".personsignature").val()},type:"POST",dataType:"json",success:function(data){_t.notieFun(data.header.desc)}})}},selectFormChange:function(){$(".dropdown_text_middle").on({mouseleave:function(e){$(this).children(".selectlist").hide()}}).find("span").on({click:function(e){$(this).siblings(".selectlist").toggle()}}).end().find(".selectlist").delegate("li","click",function(e){var s=$(this).html();var val=$(this).attr("value");$(this).parents(".dropdown_text_middle").children("span").html(s).attr("value",val);$(".selectlist").hide()})},init:function(){var _t=this;_t.birthdaySet();_t.addressSet();_t.selectFormChange();$(".submit").on("click",function(){_t.submitClick()})}};xmbbs.init()});