$(function(){var url="",obj={x1:120,y1:90,x2:280,y2:210,width:0,height:0},scale=1,preview=$("#preview"),imgw,imgh,dir=0,oTwigspan=$(".twig span");var notieFun=function(msg){var s1="<div class='modal_full in'><div class='modal-backdrop'></div><div class='modal'><span class='close'></span><h3>"+langgobale[150].string+"</h3><div>",s2="</div></div></div>";$("body").append(s1+msg+s2);$(".modal_full").fadeIn("normal",function(){setTimeout(function(){$(".modal_full").fadeOut("fast",function(){$(this).remove()})},1e3)})};$('<div ><img src="" style="position: relative;" /><div>').css({"float":"right",position:"absolute",overflow:"hidden",width:"200px",height:"200px",top:"230px",right:"65px",border:"1px solid #ccc",display:"none"}).insertAfter($("#localImag"));$("#Member_headimg").change(function(){$("input[name=position_x1]").val(0);$("input[name=position_x2]").val(0);$("input[name=position_y1]").val(0);$("input[name=position_y2]").val(0);$("input[name=size_height]").val(0);$("input[name=size_width]").val(0);$("#img_submit_form").submit()});function setImagePreview(fileObj,previewObj,localImg,w,h){$("#localImag p").addClass("pfadein").show();setTimeout(function(){$("#localImag p").removeClass("pfadein").hide()},3e3);var docObj=document.getElementById(fileObj);var imgObjPreview=document.getElementById("preview");if(docObj.files&&docObj.files[0]){imgObjPreview.style.display="block";imgObjPreview.style.width=w+"px";imgObjPreview.style.height=h+"px";var src=window.URL.createObjectURL(docObj.files[0]);imgObjPreview.src=src;$("#localImag").next("div").children("img").attr("src",src)}else{docObj.select();docObj.blur();var imgSrc=document.selection.createRange().text;var localImagId=document.getElementById(localImg);try{imgObjPreview.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";imgObjPreview.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=imgSrc;var o=$("#localImag").next("div").children("img")[0];o.style.filter="progid:DXImageTransform.Microsoft.AlphaImageLoader(sizingMethod=scale)";o.filters.item("DXImageTransform.Microsoft.AlphaImageLoader").src=imgSrc}catch(e){notieFun(langgobale[63].string);return false}imgObjPreview.style.display="block";document.selection.empty()}}function changesite(img,selection){var w=parseInt(preview.css("width")),h=parseInt(preview.css("height")),oDiv=$("#localImag + div"),scaleX=parseInt(oDiv.css("width"))/(selection.width||1),scaleY=parseInt(oDiv.css("height"))/(selection.height||1);$("#localImag").next("div").show().children("img").css({width:Math.round(scaleX*w*scale)+"px",height:Math.round(scaleY*h*scale)+"px",marginLeft:"-"+Math.round(scaleX*selection.x1*scale)+"px",marginTop:"-"+Math.round(scaleY*selection.y1*scale)+"px"});obj.x1=selection.x1;obj.x2=selection.x2;obj.width=selection.width;obj.height=selection.height;obj.y1=selection.y1;obj.y2=selection.y2}function resize(imgobj,imgsizew,imgsizeh){oTwigspan.on({"mousedown mouseenter":function(e1){dir=e1.pageX;var scale=0;$(document).on("mousemove",function(e2){var c=e2.pageX-dir;var left=parseInt(oTwigspan.css("left"));if(left>=0&&left<=190){oTwigspan.css({left:left+c+"px"});var l=Math.abs(parseInt(oTwigspan.css("left")));if(c>0){scale=1+(l-99)/100}else{scale=1-(99-l)/100}resetImgobjcss();dir=e2.pageX}if(left<0){if(c>0){oTwigspan.css({left:0+"px"});resetImgobjcss()}}if(left>190){if(c<0){oTwigspan.css({left:190+"px"});resetImgobjcss()}}function resetImgobjcss(){imgobj.css({width:scale*imgsizew+"px",height:scale*imgsizeh+"px"});changesite($("#localImag"),obj)}})},mouseup:function(){$(document).off("mousemove")}})}$(".changesize").mouseleave(function(){$(document).off("mousemove")});window.callback=function(msg,success,flag){if(flag){window.location.href=location.href}else{if(success){imgw=msg.width,imgh=msg.height;var inith;var initw=400;if(imgw>initw){inith=initw*imgh/imgw;oTwigspan.css({left:100*(1-(imgw-initw)/imgw)+"px"})}else{initw=imgw;inith=imgh;oTwigspan.css({left:100+"px"})}setImagePreview("Member_headimg","preview","localImag",initw,inith);preview.parent().imgAreaSelect({aspectRatio:"1:1",x1:120,y1:90,x2:320,y2:290,handles:true,onInit:changesite,onSelectStart:changesite,onSelectChange:changesite});$(".changesize").show();resize(preview,imgw,imgh);preview.css({width:initw+"px",height:inith+"px"});return true}else{notieFun(msg)}}};$(".headupload .btn").on({click:function(){if($("#Member_headimg").val()==""){notieFun(langgobale[64].string)}else{var w=parseInt(preview.css("width")),h=parseInt(preview.css("height"));$("input[name=position_x1]").val(obj.x1);$("input[name=position_x2]").val(obj.x2);$("input[name=position_y1]").val(obj.y1);$("input[name=position_y2]").val(obj.y2);$("input[name=size_height]").val(h);$("input[name=size_width]").val(w);$("#img_submit_form").submit()}}})});